function goFullscreen(){var e=$("#slide-container").get(0),t=e.webkitRequestFullscreen||e.requestFullscreen;t.call(e)}function showMenu(){$("#letterbox1, #letterbox2").hide();var e=$("#menu-container");$("<h1>").text("Rotator Menu").appendTo(e);var t=[];for(var n in SCENES){var i=SCENES[n];"inMenu"in i&&!i.inMenu||(i.id=n,t.push(i))}t.sort(function(e,t){return e.order-t.order});for(var o=0;o<t.length;o++){var i=t[o],a=$("<div>").addClass("item").appendTo(e);i.newGroup&&a.addClass("newgroup"),$("<a>").attr("href","?"+i.id).text(i.title).appendTo(a)}e.show(),$("#full-screen-button").hide()}function startScene(){function e(){$("#slide-container").css("background",$(".slide-background").css("background")),$(".slide-background").remove(),i=(i+1)%g_scene.colors.length;var t=g_scene.colors[i],n=$("<div>").addClass("slide-background").css("background","linear-gradient(to right, "+t[0]+", "+t[1]+")").appendTo("#slide-container");o&&n.addClass("first"),window.setTimeout(function(){n.addClass("active")},0),o=!1,n.on("transitionend",e)}stopScene(),g_slides=[];for(var t=0;t<g_scene.slideInfos.length;t++){var n=$.extend({},g_scene.slideInfos[t]);n.nextDelay=(n.nextDelay||0)*SPEED_MULTIPLIER,n.duration*=SPEED_MULTIPLIER,g_slides.push(n)}g_currentSlideIndex=-1,nextSlide();var i=-1,o=!0;e()}function stopScene(){g_slides=[],g_nextBackgroundTimeout&&(window.clearTimeout(g_nextBackgroundTimeout),g_nextBackgroundTimeout=0),g_nextSlideTimeout&&(window.clearTimeout(g_nextSlideTimeout),g_nextSlideTimeout=0),g_currentSlideTimeout&&(window.clearTimeout(g_currentSlideTimeout),g_currentSlideTimeout=0),$(".meta-bar").removeClass("visible"),$(".slide").remove()}function nextSlide(){if(document.hidden)return g_showNextSlideOnVisible=!0,void 0;g_showNextSlideOnVisible=!1;var e;g_currentSlideIndex>=0&&(e=g_slides[g_currentSlideIndex]),++g_currentSlideIndex,g_currentSlideIndex>=g_slides.length&&(g_currentSlideIndex=0),$(".slide.exiting").remove(),window.setTimeout(function(){$(".slide.active").removeClass("active").addClass("exiting")},0);var t=g_slides[g_currentSlideIndex],n=buildSlide(t),i=e?e.nextDelay||250:250;g_currentSlideTimeout&&window.clearTimeout(g_currentSlideTimeout),g_currentSlideTimeout=window.setTimeout(function(){n.trigger("becameactive"),n.addClass("active"),$(".meta-bar").toggleClass("visible","metaBar"in t?t.metaBar:!0),g_currentSlideTimeout=0},i),g_nextSlideTimeout&&window.clearTimeout(g_nextSlideTimeout),g_nextSlideTimeout=window.setTimeout(nextSlide,i+t.duration)}function buildSlide(e){var t=$("<div>").addClass("slide").addClass("type-"+e.type).appendTo("#slide-container");switch(e.type){case"intro":t.html('<video src="images/Span_RotatorLogo_SIZED_JS_v001.webm" autoplay>'),t.find("video").on("playing",function(){$(this).addClass("playing")});break;case"largetext":case"smalltext":var n=e.text;e.textChoices&&(n=e.textChoices[Math.floor(Math.random()*e.textChoices.length)]),Array.isArray(n)||(n=[n]),$("<div>").addClass("text-line "+("smalltext"==e.type?"small":"")).html(n.join("<br>").replace(/\n/g,"<br>")).appendTo(t);break;case"icons":for(var i=e.icons.slice();i.length>3;)i.splice(Math.floor(Math.random()*i.length),1);var o=0;i.forEach(function(e){$("<div>").addClass("icon").data("delay",1400*o*SPEED_MULTIPLIER).html('<video src="images/'+e+".webm?"+Math.random()+'">').appendTo(t);++o}),t.on("becameactive",function(){t.find(".icon").each(function(){var e=$(this);e.find("video").on("playing",function(){$(this).addClass("playing")}),window.setTimeout(function(){e.addClass("active"),e.find("video").get(0).play()},e.data("delay")||0)})});break;case"schedule":$("<div>").addClass("text-line location").html(e.location).appendTo(t),Array.isArray(e.content)||(e.content=[e.content]),e.content.forEach(function(e){Array.isArray(e.title)||(e.title=[e.title]),$("<div>").addClass("text-line title").html(e.title.join("<br>").replace(/\n/g,"<br>")).appendTo(t),Array.isArray(e.subtitle)||(e.subtitle=[e.subtitle]),$("<div>").addClass("text-line subtitle").html(e.subtitle.join("<br>").replace(/\n/g,"<br>")).appendTo(t)})}return t}var IS_24_HOUR_CLOCK=!1,TRANSITION_TIME=1e3,DEBUG=document.location.search.indexOf("_debug")>0,SPEED_MULTIPLIER=DEBUG?.5:1,g_sceneName=document.location.search.replace(/^\?/,"").replace(/_debug/,""),g_scene=SCENES[g_sceneName],g_slides=[],g_currentSlideIndex,g_nextSlideTimeout,g_currentSlideTimeout,g_nextBackgroundTimeout,g_showNextSlideOnVisible=!1;$(document).ready(function(){function e(){var e=i.width(),t=i.height(),o=n.width(),a=n.height(),r=1;if(e/t>o/a){r=o/e;var d=(a+t*r)/2;$("#letterbox1").css({bottom:d,right:""}),$("#letterbox2").css({top:d,left:""})}else{r=a/t;var l=(o+e/t*a)/2;$("#letterbox1").css({right:l,bottom:""}),$("#letterbox2").css({left:l,top:""})}i.css("transform","scale("+r+")")}function t(){var e=new Date,t="";t+=IS_24_HOUR_CLOCK?e.getHours():(e.getHours()+11)%12+1,t+=":";var n=e.getMinutes();t+=(10>n?"0":"")+n,$(".clock").text(t)}document.fullscreenEnabled||document.webkitFullscreenEnabled||$("#full-screen-button").hide(),$("#full-screen-button").click(function(){goFullscreen()});var n=$(document.body),i=$("#slide-container");e(),$(window).resize(e),t(),window.setInterval(t,5e3),g_sceneName?startScene():showMenu()}),$(document).on("visibilitychange",function(){!document.hidden&&g_showNextSlideOnVisible&&nextSlide()}),$(document).on("keydown",function(e){if(g_sceneName){var t=String.fromCharCode(e.keyCode).toLowerCase();"s"==t?startScene():"e"==t?stopScene():"f"==t&&goFullscreen()}});